"""Account entity for weight tracking"""
type Account @entity(immutable: false) {
  id: ID!                    # address (lowercase)
  address: Bytes!            # original address
  currentWeight: BigInt!     # current weight (always 1 for this manifesto)
  weightChangeEvents: [WeightChangeEvent!]! @derivedFrom(field: "account")
}

"""Address that has pledged to The Trustless Manifesto"""
type Signer @entity(immutable: false) {
  id: ID!                    # address (lowercase)
  address: Bytes!            # original address
  pledgeTimestamp: BigInt!   # when they pledged (unix timestamp)
  pledgeBlock: BigInt!       # block number of pledge
  transactionHash: Bytes!    # tx hash of pledge
  treeIndex: BigInt!         # index in merkle tree (order of insertion)
}

"""Census root snapshot (immutable - each update creates new entry)"""
type CensusRoot @entity(immutable: true) {
  id: ID!                    # txHash-logIndex
  root: BigInt!              # merkle root value
  blockNumber: BigInt!       # block number
  blockTimestamp: BigInt!    # timestamp
  transactionHash: Bytes!    # tx hash
  pledgeCount: BigInt!       # total pledges at this root
}

"""Global statistics"""
type GlobalStats @entity(immutable: false) {
  id: ID!                    # "global"
  totalPledges: BigInt!      # total number of pledges
  lastPledgeAt: BigInt!      # timestamp of last pledge
  lastPledgeBlock: BigInt!   # block of last pledge
  currentRoot: BigInt!       # current census root
  nextTreeIndex: BigInt!     # next tree index (counter for new insertions)
}

"""Pledge event - tracks all pledges in chronological order"""
type PledgeEvent @entity(immutable: true) {
  id: ID!                    # txHash-logIndex
  signer: Signer!            # who pledged
  timestamp: BigInt!         # when (block timestamp)
  blockNumber: BigInt!       # block number
  transactionHash: Bytes!    # tx hash
  logIndex: BigInt!          # for ordering within block
}

"""Weight change event - required for offchain census reconstruction"""
type WeightChangeEvent @entity(immutable: true) {
  id: ID!                    # txHash-logIndex
  account: Account!          # account whose weight changed
  previousWeight: BigInt!    # weight before change (0 for new accounts)
  newWeight: BigInt!         # weight after change (always 1 for pledges)
  blockNumber: BigInt!       # block number
  blockTimestamp: BigInt!    # block timestamp
  transactionHash: Bytes!    # tx hash
  logIndex: BigInt!          # for ordering within block
}
